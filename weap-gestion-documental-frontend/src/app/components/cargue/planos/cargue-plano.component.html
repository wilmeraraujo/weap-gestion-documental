<mat-card class="main-card mat-elevation-z3">
  <h2 class="titulo-card">{{ titulo }}</h2>
  <mat-divider></mat-divider>

  <div class="header botones-acciones">
  <!-- ðŸ” Buscador clÃ¡sico -->
  <!-- ðŸ” Buscador (IZQUIERDA, solo mitad de la pÃ¡gina) -->
          <div class="col buscador-container">
            <mat-form-field appearance="fill" class="buscador-field">
              <mat-label>Buscar cargue</mat-label>
              <input matInput #input placeholder="Buscar..." (keyup)="search(input.value)" />
              <button matSuffix mat-icon-button *ngIf="input.value" aria-label="Clear"
                (click)="input.value=''; search('')">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
          </div>

  <!-- ðŸŸ© Botones -->
  <div class="col-auto botones-derecha">
    <button class="btn btn-crear" routerLink="/cargue-plano/form" matTooltip="Crear" (click)="abrirModalCrear()">
      <mat-icon>add</mat-icon>
    </button>

    <button class="btn btn-anexo-tecnico1552" matTooltip="Boton 2">
    <mat-icon>file_download</mat-icon>
    </button>

    <button class="btn btn-plantilla1552" matTooltip="Boton 3">
      <mat-icon>description</mat-icon>
    </button>
  </div>
</div>

  <div class="table-container">
    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z1 full-width-table table table-hover table-striped"
      matSort
    >
      <ng-container matColumnDef="nombreArchivo">
        <th mat-header-cell *matHeaderCellDef>Nombre archivo</th>
        <td mat-cell *matCellDef="let cargue">{{ cargue.nombreArchivo }}</td>
      </ng-container>

      <ng-container matColumnDef="nitPrestador">
        <th mat-header-cell *matHeaderCellDef>Nit prestador</th>
        <td mat-cell *matCellDef="let cargue">{{ cargue.nitPrestador }}</td>
      </ng-container>

      <ng-container matColumnDef="codigoPrestador">
        <th mat-header-cell *matHeaderCellDef>CÃ³digo prestador</th>
        <td mat-cell *matCellDef="let cargue">{{ cargue.codigoPrestador }}</td>
      </ng-container>

      <ng-container matColumnDef="fechaCargue">
        <th mat-header-cell *matHeaderCellDef>Fecha cargue</th>
        <td mat-cell *matCellDef="let cargue">
          {{ cargue.fechaCargue | date: 'dd/MM/yyyy HH:mm:ss' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="erroresEnCargue">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let cargue">
          <ng-container *ngIf="cargue.ejecucionTarea?.status === 'COMPLETED'; else enProceso">
            <span [ngClass]="cargue.erroresEnCargue ? 'bg-danger text-light' : 'bg-success text-light'">
              {{ cargue.erroresEnCargue ? 'Con errores' : 'Exitoso' }}
            </span>
          </ng-container>
          <ng-template #enProceso>
            <span class="bg-warning text-dark px-2 rounded d-inline-flex align-items-center">
              <mat-progress-spinner
                diameter="16"
                mode="indeterminate"
                color="primary"
                class="spinner-inline me-2"
              ></mat-progress-spinner>
              Procesandoâ€¦
            </span>
          </ng-template>
        </td>
      </ng-container>

      <ng-container matColumnDef="numeroRegistro">
        <th mat-header-cell *matHeaderCellDef>No. Registros</th>
        <td mat-cell *matCellDef="let cargue">{{ cargue.numeroRegistro }}</td>
      </ng-container>

      <ng-container matColumnDef="usuario">
        <th mat-header-cell *matHeaderCellDef>Usuario</th>
        <td mat-cell *matCellDef="let cargue">{{ cargue.usuario }}</td>
      </ng-container>

      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let cargue">
          <button
            class="btn btn-descargar-excel"
            matTooltip="Descargar errores de cargue"
            *ngIf="cargue.erroresEnCargue === true && cargue.ejecucionTarea?.status === 'COMPLETED'"
          >
            <i class="fas fa-file-excel"></i>
          </button>

          <button
            mat-icon-button
            class="btn-descargar-certificado"
            matTooltip="Descargar certificado"
            *ngIf="!cargue.erroresEnCargue && cargue.ejecucionTarea?.status === 'COMPLETED'"
          >
            <mat-icon>download</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="mostrarColumnas" class="encabezado-tabla"></tr>
      <tr mat-row *matRowDef="let cargue; columns: mostrarColumnas"></tr>
    </table>

    <div class="alert alert-info" *ngIf="lista?.length == 0">
      No hay documentos en el sistema
    </div>
  </div>

  <mat-paginator
    [pageSizeOptions]="pageSizeOptions"
    [length]="totalRegistros"
    [pageIndex]="paginaActual"
    [pageSize]="totalPorPagina"
    showFirstLastButtons
    class="float-end mx-2"
    (page)="paginar($event)"
    aria-label="Select page"
  >
  </mat-paginator>

  <div *ngIf="loading" class="overlay-loading">
    <div class="text-center">
      <div class="spinner-border text-light" role="status"></div>
      <div class="label">Generando archivoâ€¦</div>
    </div>
  </div>
</mat-card>
